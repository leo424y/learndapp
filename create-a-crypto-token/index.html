<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<title data-react-helmet="true">建立第一個加密代幣合約 | 智能合約(Smart Contract)與分散式網頁應用(DApp)入門</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="建立第一個加密代幣合約 | 智能合約(Smart Contract)與分散式網頁應用(DApp)入門"><meta data-react-helmet="true" name="description" content="我們已寫好並部署完成了第一個智能合約，也驗證了合約確實可以運作。在閱讀完本篇後，你將學會建立一個簡易的加密代幣🔒💵。本篇目的並非為了寫出一個安全可用的加密代幣，而是以介紹代幣合約的相關概念為主， 是以對合約做了適當地簡化，好更易於理解。"><meta data-react-helmet="true" property="og:description" content="我們已寫好並部署完成了第一個智能合約，也驗證了合約確實可以運作。在閱讀完本篇後，你將學會建立一個簡易的加密代幣🔒💵。本篇目的並非為了寫出一個安全可用的加密代幣，而是以介紹代幣合約的相關概念為主， 是以對合約做了適當地簡化，好更易於理解。"><meta data-react-helmet="true" property="og:url" content="http://gasolin.github.io/learndapp/create-a-crypto-token"><link data-react-helmet="true" rel="shortcut icon" href="/learndapp/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://gasolin.github.io/learndapp/create-a-crypto-token"><link rel="stylesheet" href="/learndapp/styles.659236df.css">
<link rel="preload" href="/learndapp/styles.98c928a1.js" as="script">
<link rel="preload" href="/learndapp/runtime~main.316a8860.js" as="script">
<link rel="preload" href="/learndapp/main.a7095df2.js" as="script">
<link rel="preload" href="/learndapp/1.bc9f8227.js" as="script">
<link rel="preload" href="/learndapp/2.41ce5287.js" as="script">
<link rel="preload" href="/learndapp/45.5b9c04d3.js" as="script">
<link rel="preload" href="/learndapp/46.a3ab42fb.js" as="script">
<link rel="preload" href="/learndapp/935f2afb.1187e898.js" as="script">
<link rel="preload" href="/learndapp/17896441.884f845a.js" as="script">
<link rel="preload" href="/learndapp/b1c080fe.f131358f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/learndapp/"><img class="navbar__logo" src="/learndapp/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">智能合約(Smart Contract)與分散式網頁應用(DApp)入門</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/learndapp/"><img class="navbar__logo" src="/learndapp/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">智能合約(Smart Contract)與分散式網頁應用(DApp)入門</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Docusaurus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/">簡介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/CHANGELOG">更新紀錄</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/blockchain">區塊鏈基礎</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/what-is-blockchain">什麼是區塊鏈？</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/what-is-ethereum">什麼是以太坊(Ethereum)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/smart-contract">智能合約</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/what-is-smart-contract">什麼是智能合約(Smart Contract)?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/deploy-smart-contract">如何部署智能合約？</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/write-smart-contract-with-solidity">使用solidity語言撰寫智能合約</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/create-first-smart-contract-project">建立第一個智能合約專案</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/add-new-method-in-smart-contract">為智能合約加入新功能</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/learndapp/create-a-crypto-token">建立第一個加密代幣合約</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/create-an-erc20-compatible-token">建立標準代幣</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/add-unit-test">加入單元測試</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/howto-send-ether-from-wallet">使用MetaMask錢包收送乙太幣</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/deploy-to-testnet">將智能合約部署到公開測試網路</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/dapp">分散式網頁應用(DApp)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/what-is-dapp">分散式網頁應用(DApp)是什麼</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/create-first-dapp">建立第一個DApp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/dapp_with_webpack">使用 Webpack 編譯 DApp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/dapp-with-create-react-app">使用 React 開發 DApp</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/">簡介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/blockchain">區塊鏈基礎</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/smart-contract">智能合約</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/dapp">分散式網頁應用(DApp)</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">建立第一個加密代幣合約</h1></header><div class="markdown"><p>我們已寫好並部署完成了第一個智能合約，也驗證了合約確實可以運作。在閱讀完本篇後，你將學會建立一個簡易的加密代幣🔒💵。本篇目的並非為了寫出一個安全可用的加密代幣，而是以介紹代幣合約的相關概念為主， 是以對合約做了適當地簡化，好更易於理解。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="開發前的準備"></a>開發前的準備<a aria-hidden="true" tabindex="-1" class="hash-link" href="#開發前的準備" title="Direct link to heading">#</a></h2><p>延續上一篇的內容，在開發的過程中，我們將繼續使用<code>ganache-cli</code><sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>工具在電腦上模擬智能合約所需的乙太坊區塊鏈測試環境。</p><p>首先確保已啟動ganache-cli，若尚未啟動，可以使用以下命令啟動</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ ganache-cli</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div></div></div><p>這樣我們就可以開始建立加密代幣智能合約專案了。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="代幣合約的基礎概念"></a>代幣合約的基礎概念<a aria-hidden="true" tabindex="-1" class="hash-link" href="#代幣合約的基礎概念" title="Direct link to heading">#</a></h2><p>代幣合約扮演像是銀行🏦的角色。使用者在代幣合約中，用自己的乙太幣帳戶地址當作銀行帳戶，可以透過代幣合約執行轉帳(transfer，將代幣由一個帳戶傳送到另一個帳戶)，查詢餘額(balanceOf，查詢指定帳戶中擁有的代幣)等原本由銀行負責的工作。因為合約部署在公開區塊鏈上，所有的交易都是公開透明，可供檢驗的。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="建立一個代幣合約"></a>建立一個代幣合約<a aria-hidden="true" tabindex="-1" class="hash-link" href="#建立一個代幣合約" title="Direct link to heading">#</a></h2><p>在<code>contracts/</code>目錄下建立一個<code>SimpleToken.sol</code>檔案。也可以使用以下命令來產生檔案：</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ truffle create contract SimpleToken</span></div></div></div></div></div><p><code>SimpleToken.sol</code>檔案內容如下：</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pragma solidity ^0.4.19;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">contract SimpleToken {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  uint INITIAL_SUPPLY = 10000;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  mapping(address =&gt; uint) balances;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  function SimpleToken() public {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    balances[msg.sender] = INITIAL_SUPPLY;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // transfer token for a specified address</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  function transfer(address _to, uint _amount) public {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    require(balances[msg.sender] &gt; _amount);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    balances[msg.sender] -= _amount;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    balances[_to] += _amount;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Gets the balance of the specified address</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  function balanceOf(address _owner) public constant returns (uint) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return balances[_owner];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="講解"></a>講解<a aria-hidden="true" tabindex="-1" class="hash-link" href="#講解" title="Direct link to heading">#</a></h3><p>將程式碼定義的合約畫成UML圖如下</p><p>{% plantuml %}
class SimpleToken {
INITIAL_SUPPLY : uint
balances : map</p><ul><li>transfer()</li><li>balanceOf()
}
{% endplantuml %}</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pragma solidity ^0.4.19;</span></div></div></div></div></div><p>第一行指名目前使用的solidity版本，不同版本的solidity可能會編譯出不同的bytecode。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">uint INITIAL_SUPPLY = 10000;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mapping(address =&gt; unit) balances;</span></div></div></div></div></div><p>我們定義了初始代幣數目<code>INITIAL_SUPPLY</code>。這邊隨意選擇了一個數字<code>10000</code>。<code>uint</code>是很常用來儲存<code>正整數</code>的型別，等同於<code>uint256</code>，可以儲存256位元(bit)的資料，其他類似的還有<code>uint8</code>，<code>uint16</code>，<code>uint32</code>等。</p><p>我們用<code>mapping</code>來定義一個可以儲存鍵值對(key-value pair)的資料結構(類似Javascript中的<code>{&quot;0xaabbccddeeff&quot;: 888}</code>)，同時也需要分別指定<code>address</code>作為鍵的型別，指定<code>uint</code>作為值的型別。和 Javascript 不同之處，在於 Solidity 中定義好型別後，並不能隨時更改之後要儲存的型別。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">contract SimpleToken {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  function SimpleToken() public {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    balances[msg.sender] = INITIAL_SUPPLY;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>和合約同名的<code>SimpleToken</code>函式，就是<code>SimpleToken</code>這個合約的建構函式(constructor)。函式中我們拿<code>msg.sender</code>當作key，<code>INITIAL_SUPPLY</code>當作值，將所有的初始代幣<code>INITIAL_SUPPLY</code>都指定給<code>msg.sender</code>帳戶。
<code>msg</code>是一個全域(Global)物件<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>，<code>msg.sender</code>表示用作呼叫當前函式的帳戶。由於建構函式只有在合約部署時會被執行，因此這邊用到的<code>msg.sender</code>，也就代表著用來部署這個合約的帳戶。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function transfer(address _to, uint _amount) public {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  require(balances[msg.sender] &gt; _amount);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  balances[msg.sender] -= _amount;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  balances[_to] += _amount;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p><code>transfer</code>函式定義了如何<code>轉帳</code>，只要指定要傳送的帳戶與數目，就會從呼叫者手上把對應數目的代幣移轉到指定的帳戶上。</p><p>{% mermaid %}
graph LR
傳送者 -- 轉帳 --&gt; 代幣合約
代幣合約 -.-&gt; 修改傳送者和接收者餘額
{% endmermaid %}</p><p><code>require(balances[msg.sender] &gt; _amount);</code>語句判斷帳戶中是否還有足夠轉出的餘額，若存款小於想轉出的數目，就丟出錯誤。</p><p>這個函式這麼寫當然還是過度簡化了，若要能實際使用，需要檢查更多可能的狀況。但就先這樣吧。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function balanceOf(address _owner) public constant returns (uint256) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return balances[_owner];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p><code>balanceOf</code>函式的作用，是讓使用者可以查詢任一帳戶的餘額。透過傳入<code>_owner</code>帳戶，可以查詢<code>_owner</code>帳戶儲存在<code>balances</code>對照表中的值。</p><p>{% mermaid %}
graph LR
傳送者 --&gt; 代幣合約
代幣合約 -. 查詢結果 .-&gt; 傳送者
{% endmermaid %}</p><p>如此一來，我們就寫好一個新加密代幣🔒💵合約囉！接下來將要編譯合約並部署到區塊鏈上。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="編譯與部署"></a>編譯與部署<a aria-hidden="true" tabindex="-1" class="hash-link" href="#編譯與部署" title="Direct link to heading">#</a></h3><p>在<code>migrations/</code>目錄下建立一個<code>3_deploy_simple_token.js</code>檔案，內容如下：</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token maybe-class-name">SimpleToken</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SimpleToken&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">deployer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  deployer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">deploy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">SimpleToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>現在可執行compile與migrate命令</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ truffle compile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ truffle migrate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Using network &#x27;development&#x27;.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Running migration: 3_deploy_token.js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Deploying HelloToken...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ... 0x2c4659528c68b4e43d1edff6c989fba05e8e7e56cc4085d408426d339b4e9ba4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  SimpleToken: 0x352fa9aa18106f269d944935503afe57a00a9a0d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Saving successful migration to network...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ... 0x1434c1b61e9719f410fc6090ce37c0ec141a1738aba278dd320738e4a5d229fa</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Saving artifacts...</span></div></div></div></div></div><p>如此一來我們已將<code>SimpleToken</code>代幣合約部署到ganache上。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="驗證"></a>驗證<a aria-hidden="true" tabindex="-1" class="hash-link" href="#驗證" title="Direct link to heading">#</a></h2><p>合約部署完成後，我們可以使用<code>truffle console</code>命令開啟console，輸入以下命令來驗證合約是否能照我們設計的方式運作。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ truffle console</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; let contract</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; SimpleToken.deployed().then(instance =&gt; contract = instance)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.coinbase)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 4, c: [ 10000 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.accounts[1])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 0, c: [ 0 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.transfer(web3.eth.accounts[1], 123)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.coinbase)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 3, c: [ 9877 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf.call(web3.eth.accounts[1])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 2, c: [ 123 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="講解-1"></a>講解<a aria-hidden="true" tabindex="-1" class="hash-link" href="#講解-1" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; let contract</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; SimpleToken.deployed().then(instance =&gt; contract = instance)</span></div></div></div></div></div><p>這邊使用<code>SimpleToken.deployed().then</code>語句來取得SimpleToken合約的Instance(實例)，並存到<code>contract</code>變數中，以方便後續的呼叫。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.coinbase)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 4, c: [ 10000 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.accounts[1])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 0, c: [ 0 ] }</span></div></div></div></div></div><p>還記得啟動ganache後預設會產生10個帳戶(Accounts)嗎?。<code>web3.eth.coinbase</code> 代表操作者預設的帳戶，即10帳戶的第一個帳戶<code>web3.eth.accounts[0]</code>，所以這邊呼叫<code>web3.eth.coinbase</code>或<code>web3.eth.accounts[0]</code>結果是一樣的。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.accounts[0])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 4, c: [ 10000 ] }</span></div></div></div></div></div><p>這兩句的目的是在進行轉帳操作前，先查詢前兩個帳戶所擁有的代幣餘額。透過呼叫<code>balanceOf</code>函式，可以看到第一個帳戶(部署合約的帳戶)裡存著所有的代幣。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.transfer(web3.eth.accounts[1], 123)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div></div></div><p>接著使用<code>transfer</code>函式來傳送<code>123</code>個代幣到第二個帳戶<code>web3.eth.accounts[1]</code>。如果轉帳成功，傳送者預設帳戶中會減少123個代幣，接收者帳戶中會增加123個代幣。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.coinbase)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 3, c: [ 9877 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf.call(web3.eth.accounts[1])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 2, c: [ 123 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt;</span></div></div></div></div></div><p>我們再次透過呼叫<code>balanceOf</code>函式，查詢傳送者帳戶和接收者帳戶各自剩下的SimpleToken數目。發現轉帳真的成功了。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="你知道剛剛的程式碼裡有一堆安全漏洞嗎"></a>你知道剛剛的程式碼裡有一堆安全漏洞💣嗎?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#你知道剛剛的程式碼裡有一堆安全漏洞嗎" title="Direct link to heading">#</a></h2><p>寫智能合約看起來並不困難吧？但因為智能合約的運作是透明公開的，而且其中牽涉了代幣或金錢的流動，這提供了駭客很強的挑戰動機。</p><p>因此如果要妥善處理智能合約，會遇到的諸多安全問題。即使單純如本篇中的<code>SimpleToken</code>，也至少會遇到幾個問題：例如<code>transfer</code>函式中沒有禁止傳入負數金額，因此傳送者反過來可以從接收者那邊取得代幣。同時也沒有檢查接收者帳戶是否合法，因此傳送者可能會傳送失敗或因為送到黑洞中，白白損失了代幣。</p><p>有著一堆安全漏洞的合約，輕則執行失敗白花交易費用，嚴重則影響到合約中的代幣或以太幣。已有多起因為合約的漏洞，造成儲存在合約中的代幣或以太幣被駭客轉走，使得ICO失敗的案例。</p><p>有興趣的人可以進一步查看參考資料<sup id="fnref-4"><a href="#fn-4" class="footnote-ref">4</a></sup>和<sup id="fnref-5"><a href="#fn-5" class="footnote-ref">5</a></sup>了解智能合約當前的一些最佳實現。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="結語"></a>結語<a aria-hidden="true" tabindex="-1" class="hash-link" href="#結語" title="Direct link to heading">#</a></h2><p>看完這篇除了學到本篇講解的<code>SimpleToken</code>外，應該也可以大致看得懂truffle預設的<code>MetaCoin.sol</code>合約了（在truffle 4.x之後，MetaCoin已經從專案建立後的預設範例中移出了，但仍可以在新增專案時透過<code>truffle unbox metacoin</code>命令取得）。不同的細節可以查看solidity相關語法<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>。</p><p>下一篇會接著介紹如何使用經過驗證的函式庫，來建立一份可以放到乙太幣錢包👛的加密代幣🔒💵合約。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="參考資料"></a>參考資料<a aria-hidden="true" tabindex="-1" class="hash-link" href="#參考資料" title="Direct link to heading">#</a></h2><ul><li>[1] <a href="https://github.com/trufflesuite/ganache-cli" target="_blank" rel="noopener noreferrer">https://github.com/trufflesuite/ganache-cli</a></li><li>[2] Units and Globally Available Variables <a href="http://solidity.readthedocs.io/en/develop/units-and-global-variables.html" target="_blank" rel="noopener noreferrer">http://solidity.readthedocs.io/en/develop/units-and-global-variables.html</a></li><li>[3] An Ethereum Hello World Smart Contract for Beginners <a href="http://www.talkcrypto.org/blog/2017/04/17/an-ethereum-hello-world-smart-contract-for-beginners-part-1/" target="_blank" rel="noopener noreferrer">part 1</a>, <a href="http://www.talkcrypto.org/blog/2017/04/22/an-ethereum-hello-world-smart-contract-for-beginners-part-2/" target="_blank" rel="noopener noreferrer">part 2</a></li><li>[4] Onward with Ethereum Smart Contract Security <a href="https://blog.zeppelin.solutions/onward-with-ethereum-smart-contract-security-97a827e47702" target="_blank" rel="noopener noreferrer">https://blog.zeppelin.solutions/onward-with-ethereum-smart-contract-security-97a827e47702</a></li><li>[5] Ethereum Contract Security Techniques and Tips <a href="https://github.com/ConsenSys/smart-contract-best-practices" target="_blank" rel="noopener noreferrer">https://github.com/ConsenSys/smart-contract-best-practices</a></li><li>[6] 範例網址 <a href="https://github.com/gasolin/learndapp/tree/master/examples/hello_simple_token" target="_blank" rel="noopener noreferrer">https://github.com/gasolin/learndapp/tree/master/examples/hello_simple_token</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/create-a-crypto-token.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/learndapp/add-new-method-in-smart-contract"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 為智能合約加入新功能</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/learndapp/create-an-erc20-compatible-token"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">建立標準代幣 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#開發前的準備" class="table-of-contents__link">開發前的準備</a></li><li><a href="#代幣合約的基礎概念" class="table-of-contents__link">代幣合約的基礎概念</a></li><li><a href="#建立一個代幣合約" class="table-of-contents__link">建立一個代幣合約</a><ul><li><a href="#講解" class="table-of-contents__link">講解</a></li><li><a href="#編譯與部署" class="table-of-contents__link">編譯與部署</a></li></ul></li><li><a href="#驗證" class="table-of-contents__link">驗證</a><ul><li><a href="#講解-1" class="table-of-contents__link">講解</a></li></ul></li><li><a href="#你知道剛剛的程式碼裡有一堆安全漏洞嗎" class="table-of-contents__link">你知道剛剛的程式碼裡有一堆安全漏洞💣嗎?</a></li><li><a href="#結語" class="table-of-contents__link">結語</a></li><li><a href="#參考資料" class="table-of-contents__link">參考資料</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="http://blog.gasolin.idv.tw/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/gasolin/learndapp" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 gasolin. Built with Docusaurus.</div></div></div></footer></div>
<script src="/learndapp/styles.98c928a1.js"></script>
<script src="/learndapp/runtime~main.316a8860.js"></script>
<script src="/learndapp/main.a7095df2.js"></script>
<script src="/learndapp/1.bc9f8227.js"></script>
<script src="/learndapp/2.41ce5287.js"></script>
<script src="/learndapp/45.5b9c04d3.js"></script>
<script src="/learndapp/46.a3ab42fb.js"></script>
<script src="/learndapp/935f2afb.1187e898.js"></script>
<script src="/learndapp/17896441.884f845a.js"></script>
<script src="/learndapp/b1c080fe.f131358f.js"></script>
</body>
</html>