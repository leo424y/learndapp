<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<title data-react-helmet="true">建立第一個DApp | 智能合約(Smart Contract)與分散式網頁應用(DApp)入門</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="建立第一個DApp | 智能合約(Smart Contract)與分散式網頁應用(DApp)入門"><meta data-react-helmet="true" name="description" content="我們將用僅僅30行來完成第一個DApp。這個DApp可以顯示使用者預設的帳戶地址，並且顯示帳戶上的以太幣餘額。"><meta data-react-helmet="true" property="og:description" content="我們將用僅僅30行來完成第一個DApp。這個DApp可以顯示使用者預設的帳戶地址，並且顯示帳戶上的以太幣餘額。"><meta data-react-helmet="true" property="og:url" content="http://gasolin.github.io/learndapp/create-first-dapp"><link data-react-helmet="true" rel="shortcut icon" href="/learndapp/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://gasolin.github.io/learndapp/create-first-dapp"><link rel="stylesheet" href="/learndapp/styles.659236df.css">
<link rel="preload" href="/learndapp/styles.4a059bd4.js" as="script">
<link rel="preload" href="/learndapp/runtime~main.9d917034.js" as="script">
<link rel="preload" href="/learndapp/main.fe7756ee.js" as="script">
<link rel="preload" href="/learndapp/2.5a24fa59.js" as="script">
<link rel="preload" href="/learndapp/3.333a94e9.js" as="script">
<link rel="preload" href="/learndapp/4.5f63321f.js" as="script">
<link rel="preload" href="/learndapp/1be78505.facc14d9.js" as="script">
<link rel="preload" href="/learndapp/47.bb337c03.js" as="script">
<link rel="preload" href="/learndapp/935f2afb.911e62a0.js" as="script">
<link rel="preload" href="/learndapp/17896441.ad7a8511.js" as="script">
<link rel="preload" href="/learndapp/1.ff15d262.js" as="script">
<link rel="preload" href="/learndapp/e520bde1.950d92f7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/learndapp/"><img class="navbar__logo" src="/learndapp/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">智能合約(Smart Contract)與分散式網頁應用(DApp)入門</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/learndapp/"><img class="navbar__logo" src="/learndapp/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">智能合約(Smart Contract)與分散式網頁應用(DApp)入門</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">簡介</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/">Ethereum區塊鏈！智能合約(Smart Contract)與分散式網頁應用(dApp)入門</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/CHANGELOG">更新紀錄</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">區塊鏈</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/blockchain">區塊鏈基礎</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/what-is-blockchain">什麼是區塊鏈？</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/what-is-ethereum">什麼是以太坊(Ethereum)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">智能合約</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/smart-contract">智能合約</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/what-is-smart-contract">什麼是智能合約(Smart Contract)?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/deploy-smart-contract">如何部署智能合約？</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/write-smart-contract-with-solidity">使用solidity語言撰寫智能合約</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/create-first-smart-contract-project">建立第一個智能合約專案</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/add-new-method-in-smart-contract">為智能合約加入新功能</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/create-a-crypto-token">建立第一個加密代幣合約</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/create-an-erc20-compatible-token">建立標準代幣</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/add-unit-test">加入單元測試</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/howto-send-ether-from-wallet">使用MetaMask錢包收送乙太幣</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/deploy-to-testnet">將智能合約部署到公開測試網路</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">DApp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/dapp">分散式網頁應用(DApp)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/what-is-dapp">分散式網頁應用(DApp)是什麼</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/learndapp/create-first-dapp">建立第一個DApp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/dapp_with_webpack">使用 Webpack 編譯 DApp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/dapp-with-create-react-app">使用 React 開發 DApp</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">建立第一個DApp</h1></header><div class="markdown"><p>我們將用僅僅30行來完成第一個DApp。這個DApp可以顯示使用者預設的帳戶地址，並且顯示帳戶上的以太幣餘額。</p><p>本書後續的DApp架構並不會再使用<code>web3.js 1.x</code>或<code>web3.js 0.2x.x</code>版本，而會改用<code>Ethjs</code>（支援promise且相對穩定），各種函式庫大同小異，但嘗試過基本的<code>web3.js</code>還是對理解區塊鏈DApp開發有幫助。</p><h2 id="整個測試環境">整個測試環境</h2><p>在開始寫DApp之前，我們需要有個網頁伺服器來放DApp，瀏覽器上需安裝好<code>MetaMask</code>錢包，並開啟<code>ganache-cli</code>本地測試網路。
實際的架構如下：</p><div class="mermaid">
graph TB
瀏覽器 --- ganache
DApp --- 瀏覽器
subgraph  網頁伺服器
    DApp
end
subgraph  本地
    加密代幣錢包  --- 瀏覽器
end
subgraph  遠端
    ganache
end
</div><p>除了網頁伺服器的部分之外，閱讀完前面章節的讀者，對<code>MetaMask</code>錢包和<code>ganache</code>應該都已有經驗。</p><h2 id="設定環境">設定環境</h2><p>首先確保已啟動ganache/ganache-cli。若尚未啟動，可以使用以下命令啟動：</p><pre><code class="language-sh">ganache-cli --seed apple banana cherry
</code></pre><p>開啟一個新資料夾<code>hello_web3</code>，並加入<code>package.json</code>檔案：</p><pre><code>{
  &quot;name&quot;: &quot;helloweb3&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;hello web3 example&quot;,
  &quot;dependencies&quot;: {
    &quot;web3&quot;: &quot;^1.0.0-beta.29&quot;
  }
}
</code></pre><p>執行<code>npm install</code>命令安裝web3函式庫。這邊直接使用1.x版做範例。</p><p>此外，還需要安裝一個簡易的網頁伺服器<code>http-server</code>，來下載我們的DApp網頁到瀏覽器上。</p><pre><code class="language-sh">$ npm install http-server -g
</code></pre><h2 id="開始寫-dapp">開始寫 DApp</h2><p>建立一個<code>index.html</code>檔案，內容如下：</p><pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset = &quot;utf-8&quot;&gt;
        &lt;title&gt;Hello Web3&lt;/title&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;node_modules/web3/dist/web3.min.js&quot;&gt;&lt;/script&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
          var web3 = new Web3(Web3.givenProvider || &quot;http://127.0.0.1:8545&quot;);

          async function start() {
            try {
              let defaultAccount = await web3.eth.getCoinbase();
              let balance = await web3.eth.getBalance(defaultAccount);

              var html_account = document.getElementById(&quot;account&quot;);
              var html_balance = document.getElementById(&quot;balance&quot;);
              html_account.textContent = defaultAccount;
              html_balance.textContent = web3.utils.fromWei(balance, &quot;ether&quot;);
            } catch(err) {
              console.error(&quot;Error:&quot;, err);
            }
          }

          window.addEventListener(&quot;load&quot;, start);
        &lt;/script&gt;
      &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Account: &lt;span id=&quot;account&quot;&gt;&lt;/span&gt;&lt;/h1&gt;
        &lt;h3&gt;You have &lt;span id=&quot;balance&quot;&gt;&lt;/span&gt; Ether&lt;/h3&gt;
    &lt;/body&gt;
&lt;/html&gt;

</code></pre><p>執行<code>http-server</code>命令來啟動一個簡易的網頁伺服器。</p><pre><code>$ http-server .
</code></pre><p>在瀏覽器中打開<code>http://127.0.0.1:8080/</code>網址，可以看到帳戶地址與以太幣餘額。</p><p><img src="https://i.imgur.com/1vqPwVI.png" alt="Imgur"></p><h3 id="講解">講解</h3><p>這邊假設讀者已具備HTML與Javascript的基礎知識，因此只挑重點說明，不再一一講解。</p><pre><code class="language-html">&lt;script type=&quot;text/javascript&quot; src=&quot;node_modules/web3/dist/web3.min.js&quot;&gt;&lt;/script&gt;
</code></pre><p>這行引用了<code>web3.js</code>函式庫。</p><p>  寫作時使用npm install web3下載的函式庫中並未包含dist/目錄<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>，我已送patch去修復這個問題。
在修復之前，讀者可以先到<a href="https://github.com/ethereum/web3.js/blob/develop/dist/web3.js">github</a>下載檔案，並將web3.js將放到<code>node_modules/web3/dist/</code>目錄下。</p><p>  另一個方法是改從github直接安裝0.20.x版本 <code>npm install https://github.com/ethereum/web3.js.git#develop --save</code> 注意這邊使用的API和本書範例中使用的1.x API不同。</p><pre><code class="language-js">var web3 = new Web3(Web3.givenProvider || &quot;http://127.0.0.1:8545&quot;);
</code></pre><p>我們這邊透過<code>web3.js</code>函式庫提供的<code>Web3</code>來建立與區塊鏈網路的連線。不同的DApp瀏覽器會填入不同的Provider，若<code>Web3.givenProvider </code>的值為<code>null</code>，就會改為建立與本地網(<code>http://127.0.0.1:8545</code>)的連線。</p><pre><code class="language-js">window.addEventListener(&quot;load&quot;, start);
</code></pre><p>這行的意義是等頁面載入(load)完成後，再啟動<code>start</code>函式。</p><pre><code class="language-js">async function start() {
    try {
        ...
    } catch(err) {
       console.error(&quot;Error:&quot;, err);
    }
}
</code></pre><p><code>start</code>函式前加上<code>async</code>宣告，表示函式中可以使用await語句。用async/await語句可以讓非同步程式變得更易讀。
程式的主體包在<code>try..catch</code>語句中，若有任何錯誤都可以透過瀏覽器的<code>web console</code>工具查看。</p><pre><code class="language-js">let defaultAccount = await web3.eth.getCoinbase();
let balance = await web3.eth.getBalance(defaultAccount);
</code></pre><p>透過查看web3.js的文件<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>，可以找到如何取得預設帳戶地址(<a href="http://web3js.readthedocs.io/en/1.0/web3-eth.html#getcoinbase">web3.eth.getCoinbase</a>)，和如何從帳戶地址查詢餘額(<a href="http://web3js.readthedocs.io/en/1.0/web3-eth.html#getbalance">web3.eth.getBalance</a>)的方法。</p><pre><code class="language-js">var html_account = document.getElementById(&quot;account&quot;);
var html_balance = document.getElementById(&quot;balance&quot;);
html_account.textContent = defaultAccount;
html_balance.textContent = web3.utils.fromWei(balance, &quot;ether&quot;);
</code></pre><p>這段程式的作用是將查詢結果顯示到網頁上。<a href="http://web3js.readthedocs.io/en/1.0/web3-utils.html#fromwei">web3.utils.fromWei</a>能將乙太幣從預設的最小單位(wei)轉換成指定的單位(ether)來顯示。</p><p>你可以再試試看，在MetaＭask中從測試網路切換回<code>Main Network</code>，看看帳戶地址跟以太幣餘額是不是都能正常顯示。</p><p>恭喜！我們完成了第一個DApp！</p><h2 id="參考資料">參考資料</h2><ul><li>[1] Issue: npm install web3 doesn&#x27;t install /dist/web3.min.js <a href="https://github.com/ethereum/web3.js/issues/1041">https://github.com/ethereum/web3.js/issues/1041</a></li><li>[2] web3.js - Ethereum JavaScript API <a href="http://web3js.readthedocs.io/en/1.0/">http://web3js.readthedocs.io/en/1.0/</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/create-first-dapp.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/learndapp/what-is-dapp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 分散式網頁應用(DApp)是什麼</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/learndapp/dapp_with_webpack"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">使用 Webpack 編譯 DApp »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#整個測試環境" class="table-of-contents__link">整個測試環境</a></li><li><a href="#設定環境" class="table-of-contents__link">設定環境</a></li><li><a href="#開始寫-dapp" class="table-of-contents__link">開始寫 DApp</a><ul><li><a href="#講解" class="table-of-contents__link">講解</a></li></ul></li><li><a href="#參考資料" class="table-of-contents__link">參考資料</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="http://blog.gasolin.idv.tw/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/gasolin/learndapp" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 gasolin. Built with Docusaurus.</div></div></div></footer></div>
<script src="/learndapp/styles.4a059bd4.js"></script>
<script src="/learndapp/runtime~main.9d917034.js"></script>
<script src="/learndapp/main.fe7756ee.js"></script>
<script src="/learndapp/2.5a24fa59.js"></script>
<script src="/learndapp/3.333a94e9.js"></script>
<script src="/learndapp/4.5f63321f.js"></script>
<script src="/learndapp/1be78505.facc14d9.js"></script>
<script src="/learndapp/47.bb337c03.js"></script>
<script src="/learndapp/935f2afb.911e62a0.js"></script>
<script src="/learndapp/17896441.ad7a8511.js"></script>
<script src="/learndapp/1.ff15d262.js"></script>
<script src="/learndapp/e520bde1.950d92f7.js"></script>
</body>
</html>