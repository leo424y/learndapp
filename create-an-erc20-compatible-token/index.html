<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<title data-react-helmet="true">建立標準代幣 | 智能合約(Smart Contract)與分散式網頁應用(DApp)入門</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="建立標準代幣 | 智能合約(Smart Contract)與分散式網頁應用(DApp)入門"><meta data-react-helmet="true" name="description" content="我們已寫好並部署完成了簡單的加密代幣🔒💵合約。在閱讀完本文後，你將學會建立一個可以放到乙太幣錢包的加密代幣🔒💵。"><meta data-react-helmet="true" property="og:description" content="我們已寫好並部署完成了簡單的加密代幣🔒💵合約。在閱讀完本文後，你將學會建立一個可以放到乙太幣錢包的加密代幣🔒💵。"><meta data-react-helmet="true" property="og:url" content="http://gasolin.github.io/learndapp/create-an-erc20-compatible-token"><link data-react-helmet="true" rel="shortcut icon" href="/learndapp/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://gasolin.github.io/learndapp/create-an-erc20-compatible-token"><link rel="stylesheet" href="/learndapp/styles.659236df.css">
<link rel="preload" href="/learndapp/styles.98c928a1.js" as="script">
<link rel="preload" href="/learndapp/runtime~main.316a8860.js" as="script">
<link rel="preload" href="/learndapp/main.a7095df2.js" as="script">
<link rel="preload" href="/learndapp/1.bc9f8227.js" as="script">
<link rel="preload" href="/learndapp/2.41ce5287.js" as="script">
<link rel="preload" href="/learndapp/45.5b9c04d3.js" as="script">
<link rel="preload" href="/learndapp/46.a3ab42fb.js" as="script">
<link rel="preload" href="/learndapp/935f2afb.1187e898.js" as="script">
<link rel="preload" href="/learndapp/17896441.884f845a.js" as="script">
<link rel="preload" href="/learndapp/3b62555c.89a01a41.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/learndapp/"><img class="navbar__logo" src="/learndapp/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">智能合約(Smart Contract)與分散式網頁應用(DApp)入門</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/learndapp/"><img class="navbar__logo" src="/learndapp/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">智能合約(Smart Contract)與分散式網頁應用(DApp)入門</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Docusaurus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/">簡介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/CHANGELOG">更新紀錄</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/blockchain">區塊鏈基礎</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/what-is-blockchain">什麼是區塊鏈？</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/what-is-ethereum">什麼是以太坊(Ethereum)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/smart-contract">智能合約</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/what-is-smart-contract">什麼是智能合約(Smart Contract)?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/deploy-smart-contract">如何部署智能合約？</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/write-smart-contract-with-solidity">使用solidity語言撰寫智能合約</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/create-first-smart-contract-project">建立第一個智能合約專案</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/add-new-method-in-smart-contract">為智能合約加入新功能</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/create-a-crypto-token">建立第一個加密代幣合約</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/learndapp/create-an-erc20-compatible-token">建立標準代幣</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/add-unit-test">加入單元測試</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/howto-send-ether-from-wallet">使用MetaMask錢包收送乙太幣</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/deploy-to-testnet">將智能合約部署到公開測試網路</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/dapp">分散式網頁應用(DApp)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/what-is-dapp">分散式網頁應用(DApp)是什麼</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/create-first-dapp">建立第一個DApp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/dapp_with_webpack">使用 Webpack 編譯 DApp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/learndapp/dapp-with-create-react-app">使用 React 開發 DApp</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/">簡介</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/blockchain">區塊鏈基礎</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/smart-contract">智能合約</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/learndapp/dapp">分散式網頁應用(DApp)</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">建立標準代幣</h1></header><div class="markdown"><p>我們已寫好並部署完成了簡單的加密代幣🔒💵合約。在閱讀完本文後，你將學會建立一個可以放到乙太幣錢包👛的加密代幣🔒💵。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="開發前的準備"></a>開發前的準備<a aria-hidden="true" tabindex="-1" class="hash-link" href="#開發前的準備" title="Direct link to heading">#</a></h2><p>延續上一篇的內容，在開發的過程中，我們將繼續使用<code>ganache-cli</code><sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>工具在電腦上模擬智能合約所需的乙太坊區塊鏈測試環境。</p><p>首先確保已啟動ganache-cli。若尚未啟動，可以使用以下命令啟動：</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ ganache-cli</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div></div></div><p>這邊有個值得一學的小技巧：在啟動ganache-cli時加上<code>--seed</code>參數，例如</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ganache-cli --seed apple banana cherry</span></div></div></div></div></div><p>這樣之後重新啟動ganache-cli時可以產生一樣的帳戶(accounts)和私鑰(private key)。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="erc20標準"></a>ERC20標準<a aria-hidden="true" tabindex="-1" class="hash-link" href="#erc20標準" title="Direct link to heading">#</a></h2><p>建立的代幣若要能透過乙太幣錢包👛來收送，必須相容於以太坊的ERC20標準<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>。ERC20標準定義了支援錢包所必須的合約介面。</p><p>本篇將使用<code>OpenZeppelin</code><sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>函式庫來簡化建立加密代幣🔒💵的過程。<code>OpenZeppelin</code>(zeppelin-solidity)是一套協助撰寫安全的加密合約的函式庫，裡面也提供了相容ERC20標準的智能合約。</p><p>我們會使用到Node.js的套件管理工具<code>npm</code>(Node Package Manager)來安裝<code>zeppelin-solidity</code>套件。在執行安裝命令前，需要先建立<code>npm</code>所需的<code>package.json</code>檔案：</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;name&quot;: &quot;hellotoken&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;version&quot;: &quot;1.0.0&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;description&quot;: &quot;hello token example&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>然後再透過<code>npm</code>工具將<code>zeppelin-solidity</code>安裝到專案目錄<code>node_modules/zeppelin-solodity/</code>中：</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ npm install zeppelin-solidity</span></div></div></div></div></div><p>準備完成，我們可以開始建立新的加密代幣智能合約了。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="建立一個標準代幣合約"></a>建立一個標準代幣合約<a aria-hidden="true" tabindex="-1" class="hash-link" href="#建立一個標準代幣合約" title="Direct link to heading">#</a></h2><p>在<code>contracts/</code>目錄下建立一個<code>HelloToken.sol</code>檔案。也可以使用以下命令來產生檔案：</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ truffle create contract HelloToken</span></div></div></div></div></div><p><code>HelloToken.sol</code>檔案內容如下：</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pragma solidity ^0.4.19;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &quot;zeppelin-solidity/contracts/token/ERC20/StandardToken.sol&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">contract HelloToken is StandardToken {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  string public name = &quot;HelloCoin&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  string public symbol = &quot;H@&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  uint8 public decimals = 2;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  uint256 public INITIAL_SUPPLY = 88888;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  function HelloToken() public {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    totalSupply_ = INITIAL_SUPPLY;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    balances[msg.sender] = INITIAL_SUPPLY;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="講解"></a>講解<a aria-hidden="true" tabindex="-1" class="hash-link" href="#講解" title="Direct link to heading">#</a></h3><p>{% plantuml %}
ERC20Basic &lt;|-- BasicToken
ERC20Basic &lt;|-- ERC20
SafeMath &lt;|-- BasicToken
BasicToken &lt;|-- StandardToken
ERC20 &lt;|-- StandardToken
StandardToken &lt;|-- HelloToken</p><p>class SafeMath {
}</p><p>interface ERC20Basic</p><p>class BasicToken {</p><ul><li>balances : map</li><li>totalSupply_ : uint256</li><li>totalSupply()</li><li>transfer()</li><li>balanceOf()
}</li></ul><p>interface ERC20</p><p>class StandardToken {</p><ul><li>allowed : map</li></ul><ul><li>transferFrom()</li><li>approve()</li><li>allowance()</li><li>increaseApproval()</li><li>decreaseApproval()
}</li></ul><p>class HelloToken {
name : string
symbol : string
decimals : uint8
INITIAL_SUPPLY : uint256
}
{% endplantuml %}</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pragma solidity ^0.4.19;</span></div></div></div></div></div><p>第一行指名目前使用的solidity版本，不同版本的solidity可能會編譯出不同的bytecode。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &quot;zeppelin-solidity/contracts/token/StandardToken.sol&quot;;</span></div></div></div></div></div><p>接著我們使用<code>import</code>語句，來讀入<code>zeppelin-solidity</code>提供的<code>StandardToken</code>合約。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">contract HelloToken is StandardToken {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>建立<code>HelloToken</code>合約時，使用<code>is</code>語句繼承了<a href="https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/token/StandardToken.sol" target="_blank" rel="noopener noreferrer">StandardToken</a>合約。因此<code>HelloToken</code>合約繼承了<code>StandardToken</code>合約所包含的資料與呼叫方法。</p><p>當我們繼承了<code>StandardToken</code>合約，也就支援了以下ERC-20標準中<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>規定的函式</p><table><thead><tr><th>函式</th><th>描述</th></tr></thead><tbody><tr><td>totalSupply()</td><td>代幣發行的總量</td></tr><tr><td>balanceOf(A)</td><td>查詢A帳戶下的代幣數目</td></tr><tr><td>transfer(A,x)</td><td>傳送x個代幣到A帳戶</td></tr><tr><td>transferFrom(A,x)</td><td>從A帳戶提取x個代幣</td></tr><tr><td>approve(A,x)</td><td>同意A帳戶從我的帳戶中提取代幣</td></tr><tr><td>allowance(A,B)</td><td>查詢B帳戶可以從A帳戶提取多少代幣</td></tr></tbody></table><p>和前一篇一樣，後面驗證時會用到<code>balanceOf</code>和<code>transfer</code>兩個函式。因為<code>StandardToken</code>合約中已經幫我們實做了這些函式，因此我們不需要自己從頭再寫一次。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">string public name = &quot;HelloCoin&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">string public symbol = &quot;H@&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">uint8 public decimals = 2;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">uint256 public INITIAL_SUPPLY = 100000;</span></div></div></div></div></div><p>這邊設定參數的目的是指定這個代幣的一些特性。以美元為例，美元的名稱(<code>name</code>)是<code>dollar</code>，美元的代號為<code>$</code>，拿一美元去找零最小可以拿到零錢是一美分(cent)，也就是0.01元。因為一美元最小可分割到小數點後2位(0.01)，因此最小交易單位(decimals)為2。</p><p>這邊將這個加密代幣取名(name)為<code>HelloCoin</code>(哈囉幣)，代幣的代號(symbol)為<code>H@</code>，最小分割單位是2(最小可以找0.01個哈囉幣)。</p><p>以下為美金，比特幣，以太幣，哈囉幣的對照表供參考：</p><table><thead><tr><th>Name</th><th>Symbol</th><th>decimals</th></tr></thead><tbody><tr><td>Dollar</td><td>$</td><td>2</td></tr><tr><td>Bitcoin</td><td>BTC</td><td>8</td></tr><tr><td>Ethereum</td><td>ETH</td><td>18</td></tr><tr><td>HelloCoin</td><td>H@</td><td>2</td></tr></tbody></table><p>最後也定義了初始代幣數目<code>INITIAL_SUPPLY</code>為<code>100000</code>。當我們把全域變數設為<code>public</code>(公開)，編譯時就會自動新增一個讀取公開變數的ABI接口，我們在<code>truffle console</code>中也可以讀取這些變數。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">function HelloToken() public {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  totalSupply_ = INITIAL_SUPPLY;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  balances[msg.sender] = INITIAL_SUPPLY;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>和合約同名的<code>HelloToken</code>方法，就是<code>HelloToken</code>合約的建構函式(constructor)。
在建構式裡指定了<code>totalSupply_</code>數目，並將所有的初始代幣<code>INITIAL_SUPPLY</code>都指定給<code>msg.sender</code>帳戶，也就是用來部署這個合約的帳戶。‵<code>totalSupply_</code>與<code>balances</code>都定義於<a href="https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/token/ERC20/BasicToken.sol" target="_blank" rel="noopener noreferrer">BasicToken.sol</a>中。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &quot;./ERC20Basic.sol&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &#x27;../math/SafeMath.sol&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using SafeMath for uint256;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mapping(address =&gt; uint256) balances;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">uint256 totalSupply_;</span></div></div></div></div></div><p>進一步追去看<a href="https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/token/BasicToken.sol" target="_blank" rel="noopener noreferrer">BasicToken.sol</a>合約的內容，可以發現<code>BasicToken.sol</code>合約中匯入了<code>SafeMath.sol</code>合約<sup id="fnref-7"><a href="#fn-7" class="footnote-ref">7</a></sup>。<code>SafeMath</code>對各種數值運算加入了必要的驗證，讓合約中的數字計算更安全。</p><p>如此一來，我們已寫好一個可透過以太幣錢包交易的新加密代幣🔒💵合約。如果將這個合約部署到乙太坊公開區塊鏈上，這個代幣合約就會一直存在，世界上從此也就多了一種新的加密代幣。只要你能找到人想擁有這種代幣，這種代幣就有交易的價值。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="編譯與部署"></a>編譯與部署<a aria-hidden="true" tabindex="-1" class="hash-link" href="#編譯與部署" title="Direct link to heading">#</a></h3><p>在<code>migrations/</code>目錄下建立一個<code>4_deploy_hellotoken.js</code>檔案，內容如下：</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token maybe-class-name">HelloToken</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> artifacts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;HelloToken&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">deployer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  deployer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">deploy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">HelloToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>現在執行compile與migrate命令</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ truffle compile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ truffle migrate --reset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Using network &#x27;development&#x27;.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Running migration: 4_deploy_hellotoken.js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Deploying HelloToken...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ... 0x2c4659528c68b4e43d1edff6c989fba05e8e7e56cc4085d408426d339b4e9ba4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  HelloToken: 0x352fa9aa18106f269d944935503afe57a00a9a0d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Saving successful migration to network...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ... 0x1434c1b61e9719f410fc6090ce37c0ec141a1738aba278dd320738e4a5d229fa</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Saving artifacts...</span></div></div></div></div></div><p>如此一來我們已將HelloCoin代幣合約部署到ganache上。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="驗證"></a>驗證<a aria-hidden="true" tabindex="-1" class="hash-link" href="#驗證" title="Direct link to heading">#</a></h2><p>我們一樣可以透過<code>truffle console</code>來驗證<code>HelloToken</code>是否部署成功。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ truffle console</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; let contract</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; HelloToken.deployed().then(instance =&gt; contract = instance)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.address</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;0x352fa9aa18106f269d944935503afe57a00a9a0d&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.coinbase)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 5, c: [ 100000 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.accounts[1])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 0, c: [ 0 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.transfer(web3.eth.accounts[1], 123)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.accounts[0])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 4, c: [ 99877 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.accounts[1])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 2, c: [ 123 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="講解-1"></a>講解<a aria-hidden="true" tabindex="-1" class="hash-link" href="#講解-1" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; let contract</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; SimpleToken.deployed().then(instance =&gt; contract = instance)</span></div></div></div></div></div><p>這邊使用<code>HelloToken.deployed().then</code>語句來取得HelloToken合約的Instance(實例)，並存到<code>contract</code>變數中，以方便後續的呼叫。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.coinbase)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 5, c: [ 100000 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.accounts[1])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 0, c: [ 0 ] }</span></div></div></div></div></div><p><code>web3.eth.coinbase</code> 代表操作者預設的帳戶，即ganache所提供的10個帳戶中的第一個帳戶，也可以透過<code>web3.eth.accounts[0]</code>取得。
這兩句的目的是在進行轉帳操作前，先查詢前兩個帳戶所擁有的代幣餘額。透過呼叫<code>balanceOf</code>函式，可以看到第一個帳戶(部署合約的帳戶)裡存著所有的代幣。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.transfer(web3.eth.accounts[1], 123)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div></div></div><p>接著使用<code>transfer</code>函式來傳送<code>123</code>個代幣到第二帳戶<code>web3.eth.accounts[1]</code>。如果轉帳成功，傳送者預設帳戶中會減少<code>123</code>個代幣，接收者帳戶中會增加<code>123</code>個代幣。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.accounts[0])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 4, c: [ 99877 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; contract.balanceOf(web3.eth.accounts[1])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BigNumber { s: 1, e: 2, c: [ 123 ] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt;</span></div></div></div></div></div><p>我們再次透過呼叫<code>balanceOf</code>函式，查詢傳送者帳戶接收者帳戶各自剩下的HelloToken數目。發現轉帳真的成功了。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="結語"></a>結語<a aria-hidden="true" tabindex="-1" class="hash-link" href="#結語" title="Direct link to heading">#</a></h2><p>我們用到 <code>OpenZeppelin</code>提供的函式庫來簡化撰寫加密代幣合約的工作。要實際投入使用前，還是建議將呼叫到的程式碼都再審查幾遍。可以從 OpenZeppelin 自己提供的Audit開始看<sup id="fnref-4"><a href="#fn-4" class="footnote-ref">4</a></sup>，可以學到一些觀念。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="參考資料"></a>參考資料<a aria-hidden="true" tabindex="-1" class="hash-link" href="#參考資料" title="Direct link to heading">#</a></h2><ul><li>[1] <a href="https://github.com/trufflesuite/ganache-cli" target="_blank" rel="noopener noreferrer">https://github.com/trufflesuite/ganache-cli</a></li><li>[2] ERC20 <a href="https://theethereum.wiki/w/index.php/ERC20_Token_Standard" target="_blank" rel="noopener noreferrer">https://theethereum.wiki/w/index.php/ERC20_Token_Standard</a> 或 <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20-token-standard.md" target="_blank" rel="noopener noreferrer">https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20-token-standard.md</a></li><li>[3] OpenZeppelin <a href="https://github.com/OpenZeppelin/zeppelin-solidity" target="_blank" rel="noopener noreferrer">https://github.com/OpenZeppelin/zeppelin-solidity</a></li><li>[4] OpenZeppelin Audit <a href="https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/audit/ZeppelinAudit.md" target="_blank" rel="noopener noreferrer">https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/audit/ZeppelinAudit.md</a></li><li>[5] An Ethereum Hello World Smart Contract for Beginners part 1 <a href="http://www.talkcrypto.org/blog/2017/04/17/an-ethereum-hello-world-smart-contract-for-beginners-part-1/" target="_blank" rel="noopener noreferrer">http://www.talkcrypto.org/blog/2017/04/17/an-ethereum-hello-world-smart-contract-for-beginners-part-1/</a></li><li>[6] <a href="http://www.talkcrypto.org/blog/2017/04/22/an-ethereum-hello-world-smart-contract-for-beginners-part-2/" target="_blank" rel="noopener noreferrer">http://www.talkcrypto.org/blog/2017/04/22/an-ethereum-hello-world-smart-contract-for-beginners-part-2/</a></li><li>[7] OpenZeppelin <a href="https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/math/SafeMath.sol" target="_blank" rel="noopener noreferrer">SafeMath 合約</a></li><li>[8] 範例網址 <a href="https://github.com/gasolin/learndapp/tree/master/examples/hello_standard_token" target="_blank" rel="noopener noreferrer">https://github.com/gasolin/learndapp/tree/master/examples/hello_standard_token</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/create-an-erc20-compatible-token.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/learndapp/create-a-crypto-token"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 建立第一個加密代幣合約</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/learndapp/add-unit-test"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">加入單元測試 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#開發前的準備" class="table-of-contents__link">開發前的準備</a></li><li><a href="#erc20標準" class="table-of-contents__link">ERC20標準</a></li><li><a href="#建立一個標準代幣合約" class="table-of-contents__link">建立一個標準代幣合約</a><ul><li><a href="#講解" class="table-of-contents__link">講解</a></li><li><a href="#編譯與部署" class="table-of-contents__link">編譯與部署</a></li></ul></li><li><a href="#驗證" class="table-of-contents__link">驗證</a><ul><li><a href="#講解-1" class="table-of-contents__link">講解</a></li></ul></li><li><a href="#結語" class="table-of-contents__link">結語</a></li><li><a href="#參考資料" class="table-of-contents__link">參考資料</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="http://blog.gasolin.idv.tw/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/gasolin/learndapp" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 gasolin. Built with Docusaurus.</div></div></div></footer></div>
<script src="/learndapp/styles.98c928a1.js"></script>
<script src="/learndapp/runtime~main.316a8860.js"></script>
<script src="/learndapp/main.a7095df2.js"></script>
<script src="/learndapp/1.bc9f8227.js"></script>
<script src="/learndapp/2.41ce5287.js"></script>
<script src="/learndapp/45.5b9c04d3.js"></script>
<script src="/learndapp/46.a3ab42fb.js"></script>
<script src="/learndapp/935f2afb.1187e898.js"></script>
<script src="/learndapp/17896441.884f845a.js"></script>
<script src="/learndapp/3b62555c.89a01a41.js"></script>
</body>
</html>